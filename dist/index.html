<!DOCTYPE HTML>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, width=device-width, user-scalable=yes">
<title>Calendar</title>
<link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
<div id="wrapper">
    <div class="calendar">
    </div>
</div>

<script type="text/javascript" src="js/lib.min.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<script>

	var calendar = {
		init: function(){
            this.yearPrint();
        },
        yearPrint: function(){
			var repeat = 12;
			for(var k = 0; k < repeat; k++){
				this.draw(k);
			}
        },
        draw: function(add){
			var today = moment().add(add, 'month');
			var todayMonth = today.format('MM')
			var startWeek = today.startOf('month').week();
			// var endWeek = today.endOf('month').week();
			var endWeek = today.endOf('month').week() === 1 ? 53 : today.endOf('month').week();
			// console.log(today)
			var calendar = '';
			calendar += '<div class="content">'
			calendar += '<p class="title">' + today.format('Y') + '년 ' + today.format('M') +'월</p>'
			calendar += '<div class="wrap">'
			calendar += '<div class="week header">'
			calendar += '<div>일</div><div>월</div><div>화</div><div>수</div><div>목</div><div>금</div><div>토</div>'
			calendar += '</div>'
			calendar += '<div class="table">'

			for( var week = startWeek; week <= endWeek; week++ ){
				calendar += '<div class="week">'
				for(var i=0; i<7; i++ ){
					var current = today.week(week).startOf('week').add(i, 'day');

					// var isToday = today.format('YYYYMMDD') === current.format('YYYYMMDD') ? 'today' : '';
					// let isGrayed = current.format('MM') === today.format('MM') ? '' : 'grayed';

					// console.log(todayMonth)
					if( current.format('MM') !== todayMonth){
						calendar += '<div class="grayed">';
					}else{
						calendar += '<div class="day" data-role="'+ current.format('YYYY-MM-DD') + '">';
                    }

					calendar += '<span class="number">'+ current.format('D') +'</span>';
					calendar += '</div>'

				}
				calendar += '</div>'
			}
			calendar += '</div>'
			calendar += '</div>'
			calendar += '</div>'
			$('.calendar').append(calendar);
        }
    }
	calendar.init();

	// $('.calendar .table .week').selectable({
	// 	cancel: 'div.grayed',
	// 	stop: function( event, ui ){
    //
    //     },
	// 	selected: function( event, ui ) {
	// 		console.log(ui.selected);
	// 		// if( ui.selected.hasClass('day')){
	// 		// 	ui.selected.addClass('selected');
    //         // }
    //     }
    // });

    var shiftArray = [];
	$(document).on('click','.day',function(e){
		if(e.shiftKey) {
			// console.log( e.target )
			shiftArray.push(e.target.dataset.role);
			if( shiftArray.length > 1 ){
				console.log(shiftArray);
				// console.log(moment(shiftArray[0]).isBefore(shiftArray[1]))
                var isBefore = moment(shiftArray[0]).isBefore(shiftArray[1]);
				if( isBefore ){
					var startDay = moment(shiftArray[0]);
					var endDay = moment(shiftArray[1]);
				}else{
					var startDay = moment(shiftArray[1]);
					var endDay = moment(shiftArray[0]);
				}
				var diff = endDay.diff(startDay, 'days');

                // console.log(diff);
				// var today = moment().add(add, 'month');
				// var element = $('div[data-role="2020-07-08"]');

				for (var i = 0; i <= diff; i++ ){
					var n = 1;
					if( i === 0 ) n = 0;
					// console.log(startDay.format('YYYY-MM-DD'));
					// console.log(i);
					var select = startDay.add(n, 'days').format('YYYY-MM-DD');
					console.log(select);
					$('div[data-role='+ select +']').addClass('selected');
				}
				shiftArray = [];
			}
			return;
		}

		if( ! $(this).hasClass('selected')){
			$(this).addClass('selected');
        }else{
			$(this).removeClass('selected');
        }
    });

</script>
</body>
</html>